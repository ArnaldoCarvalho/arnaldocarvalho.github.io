
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consultoria Auto Premium</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
    body {
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
    }
    .hero {
      background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1552664730-d307ca884978?auto=format&fit=crop&w=1400&h=800&q=80') center/cover no-repeat;
      color: white;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
      padding: 150px 0;
      position: relative;
    }
    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.3);
      z-index: 1;
    }
    .hero .container {
      position: relative;
      z-index: 2;
    }
    .hero h1 {
      animation: fadeInUp 1s ease-out;
    }
    .hero p {
      animation: fadeInUp 1s ease-out 0.5s both;
    }
    .hero .btn {
      animation: fadeInUp 1s ease-out 1s both;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .section {
      padding: 80px 0;
    }
    .card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: none;
      border-radius: 15px;
    }
    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    }
    .btn-primary {
      background: linear-gradient(45deg, #007bff, #0056b3);
      border: none;
      border-radius: 25px;
      padding: 12px 30px;
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0,123,255,0.4);
    }
    .testimonial {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin: 20px 0;
    }
    .stats {
      background: linear-gradient(45deg, #28a745, #20c997);
      color: white;
      padding: 40px 0;
      text-align: center;
    }
    .stats h3 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    footer {
      background: #111;
      color: #aaa;
      padding: 40px 0;
    }
    .fade-in {
      animation: fadeIn 1s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">Consultoria Auto Premium</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="#consultoria">Consultoria</a></li>
          <li class="nav-item"><a class="nav-link" href="#historico">Histórico</a></li>
          <li class="nav-item"><a class="nav-link" href="#analytics">Analytics</a></li>
          <li class="nav-item"><a class="nav-link" href="#sobre">Sobre Nós</a></li>
          <li class="nav-item"><a class="nav-link" href="#contacto">Contacto</a></li>
          <li class="nav-item"><button class="btn btn-outline-light ms-3" id="logoutBtn">Logout</button></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <header class="hero text-center">
    <div class="container">
      <h1 class="display-4 fw-bold">Encontre o Melhor Local para seu Stand de Carros</h1>
      <p class="lead">No Grande Porto, utilizando análise de dados avançada com o método Apriori.</p>
      <a href="#consultoria" class="btn btn-primary btn-lg mt-3">Iniciar Consultoria</a>
    </div>
  </header>

  <!-- Consultoria -->
  <section id="consultoria" class="py-5">
    <div class="container">
      <h2 class="text-center mb-4">Ferramenta de Consultoria com Apriori Inovador</h2>
      <p class="text-center mb-4">Utilizamos uma versão inovadora do algoritmo Apriori que analisa associações multidimensionais em dados históricos, considerando não apenas combinações simples, mas também pesos dinâmicos baseados em tendências atuais do mercado automóvel no Grande Porto. Responda às perguntas abaixo para receber uma recomendação personalizada.</p>
      <div class="alert alert-info text-center">
        <strong>Método Inovador:</strong> Nosso Apriori avançado incorpora machine learning leve para ajustar confianças em tempo real, garantindo recomendações mais precisas e adaptáveis às mudanças econômicas.
      </div>
      <div class="row justify-content-center">
        <div class="col-md-6">
          <form id="consultoriaForm">
            <div class="mb-3">
              <label for="gama" class="form-label">Tipo de Gama</label>
              <select class="form-select" id="gama" required>
                <option value="">Selecione</option>
                <option value="luxo">Luxo</option>
                <option value="medio">Médio</option>
                <option value="economico">Económico</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="orcamento" class="form-label">Orçamento</label>
              <select class="form-select" id="orcamento" required>
                <option value="">Selecione</option>
                <option value="baixo">Baixo</option>
                <option value="medio">Médio</option>
                <option value="alto">Alto</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="cliente" class="form-label">Tipo de Cliente Alvo</label>
              <select class="form-select" id="cliente" required>
                <option value="">Selecione</option>
                <option value="familias">Famílias</option>
                <option value="jovens">Jovens</option>
                <option value="executivos">Executivos</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="localizacao" class="form-label">Preferência de Localização</label>
              <select class="form-select" id="localizacao" required>
                <option value="">Selecione</option>
                <option value="centro">Centro</option>
                <option value="subúrbios">Subúrbios</option>
                <option value="praia">Próximo à Praia</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="localEspecifico" class="form-label">Local Específico (Opcional)</label>
              <input type="text" class="form-control" id="localEspecifico" list="locaisDisponiveis" placeholder="Ex: Porto Centro, Vila Nova de Gaia, etc.">
              <datalist id="locaisDisponiveis">
                <option value="Porto Centro">
                <option value="Vila Nova de Gaia">
                <option value="Leça da Palmeira">
                <option value="Gondomar">
                <option value="Maia">
                <option value="Póvoa de Varzim">
              </datalist>
              <div class="form-text">Se preferir um local específico, selecione uma das opções disponíveis ou indique outro local. Caso contrário, receberá uma recomendação baseada nos seus critérios.</div>
            </div>

            <!-- Filtros Avançados -->
            <div class="mb-3">
              <button class="btn btn-outline-secondary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#filtrosAvancados" aria-expanded="false" aria-controls="filtrosAvancados">
                Filtros Avançados <i class="fas fa-chevron-down"></i>
              </button>
            </div>
            <div class="collapse" id="filtrosAvancados">
              <div class="mb-3">
                <label for="faixaOrcamento" class="form-label">Faixa de Orçamento (€)</label>
                <div class="row">
                  <div class="col-6">
                    <input type="number" class="form-control" id="orcamentoMin" placeholder="Mínimo" min="0">
                  </div>
                  <div class="col-6">
                    <input type="number" class="form-control" id="orcamentoMax" placeholder="Máximo" min="0">
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label for="tiposCarro" class="form-label">Tipos de Carro</label>
                <select class="form-select" id="tiposCarro" multiple>
                  <option value="sedan">Sedan</option>
                  <option value="suv">SUV</option>
                  <option value="hatchback">Hatchback</option>
                  <option value="coupe">Coupe</option>
                  <option value="pickup">Pickup</option>
                  <option value="eletrico">Elétrico</option>
                </select>
                <div class="form-text">Selecione múltiplos tipos pressionando Ctrl (ou Cmd no Mac).</div>
              </div>
              <div class="mb-3">
                <label for="faixaEtaria" class="form-label">Faixa Etária do Cliente</label>
                <select class="form-select" id="faixaEtaria">
                  <option value="">Selecione</option>
                  <option value="18-25">18-25 anos</option>
                  <option value="26-40">26-40 anos</option>
                  <option value="41-60">41-60 anos</option>
                  <option value="60+">60+ anos</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="nivelRendimento" class="form-label">Nível de Rendimento</label>
                <select class="form-select" id="nivelRendimento">
                  <option value="">Selecione</option>
                  <option value="baixo">Baixo</option>
                  <option value="medio">Médio</option>
                  <option value="alto">Alto</option>
                </select>
              </div>
            </div>

            <button type="submit" class="btn btn-primary w-100">Gerar Recomendação</button>
          </form>
          <div id="resultado" class="mt-4 d-none">
            <h5 class="text-center mb-3">Recomendação Personalizada</h5>
            <div class="card shadow-lg">
              <div class="card-body text-center">
                <img id="localImage" src="" alt="Local Recomendado" class="img-fluid rounded mb-3" style="max-height: 300px;">
                <h6 id="recomendacao" class="card-text"></h6>
                <p id="localDescription" class="text-muted"></p>
                <img id="map" src="https://images.unsplash.com/photo-1524661135-423995f22d0b?auto=format&fit=crop&w=400&h=300" alt="Mapa do Local Recomendado" style="width: 100%; height: 300px; object-fit: cover; margin-top: 20px;">
                <div class="mt-3">
                  <p class="mb-2">Esta recomendação foi útil?</p>
                  <button type="button" id="thumbsUp" class="btn btn-success me-2"><i class="fas fa-thumbs-up"></i> Sim</button>
                  <button type="button" id="thumbsDown" class="btn btn-danger"><i class="fas fa-thumbs-down"></i> Não</button>
                </div>
                <div class="mt-3">
                  <button type="button" id="exportBtn" class="btn btn-primary me-2"><i class="fas fa-download"></i> Exportar Relatório</button>
                  <button type="button" id="shareBtn" class="btn btn-info me-2"><i class="fas fa-share"></i> Compartilhar</button>
                  <button type="button" id="directionsBtn" class="btn btn-secondary me-2"><i class="fas fa-route"></i> Direções</button>
                  <button type="button" id="emailRecomendacaoBtn" class="btn btn-warning"><i class="fas fa-envelope"></i> Enviar por Email</button>
                </div>
                <div class="mt-3">
                  <label for="emailRecomendacao" class="form-label">Email para receber recomendação</label>
                  <input type="email" class="form-control" id="emailRecomendacao" placeholder="seuemail@example.com">
                </div>
                <div id="nearbyAmenities" class="mt-3 d-none">
                  <h6>Comodidades Próximas:</h6>
                  <div id="amenitiesList" class="row"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Seção de Comparação -->
          <div id="comparacaoSection" class="mt-5 d-none">
            <h5 class="text-center mb-4">Comparação de Locais Recomendados</h5>
            <div id="comparacaoContainer" class="row justify-content-center">
              <!-- As comparações serão inseridas aqui dinamicamente -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Histórico -->
  <section id="historico" class="py-5 bg-light">
    <div class="container">
      <h2 class="text-center mb-4">Histórico de Recomendações</h2>
      <p class="text-center mb-4">Aqui pode ver todas as recomendações geradas anteriormente, incluindo os critérios utilizados e o feedback dado.</p>
      <div id="historicoLista" class="row">
        <!-- As recomendações serão inseridas aqui dinamicamente -->
      </div>
      <div class="text-center mt-4">
        <button id="limparHistorico" class="btn btn-danger">Limpar Histórico</button>
      </div>
    </div>
  </section>

  <!-- Analytics -->
  <section id="analytics" class="py-5">
    <div class="container">
      <h2 class="text-center mb-4">Dashboard de Analytics</h2>
      <p class="text-center mb-4">Análise de dados das recomendações geradas, incluindo estatísticas de sucesso e padrões de utilização.</p>
      <div id="analyticsContainer">
        <!-- Os gráficos serão renderizados aqui -->
      </div>
    </div>
  </section>

  <!-- Stats -->
  <section class="stats">
    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <h3>500+</h3>
          <p>Recomendações Geradas</p>
        </div>
        <div class="col-md-3">
          <h3>95%</h3>
          <p>Satisfação dos Clientes</p>
        </div>
        <div class="col-md-3">
          <h3>10+</h3>
          <p>Anos de Experiência</p>
        </div>
        <div class="col-md-3">
          <h3>7</h3>
          <p>Locais no Grande Porto</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Testemunhos -->
  <section class="py-5 bg-light">
    <div class="container">
      <h2 class="text-center mb-5">O que Nossos Clientes Dizem</h2>
      <div class="row">
        <div class="col-md-4">
          <div class="testimonial fade-in">
            <p>"A recomendação da Consultoria Auto Premium foi perfeita! Abri meu stand em Vila Nova de Gaia e o negócio está a prosperar."</p>
            <cite>- João Silva, Empreendedor</cite>
          </div>
        </div>
        <div class="col-md-4">
          <div class="testimonial fade-in">
            <p>"O método Apriori inovador deu-me confiança para investir. Recomendo a todos!"</p>
            <cite>- Maria Santos, Investidora</cite>
          </div>
        </div>
        <div class="col-md-4">
          <div class="testimonial fade-in">
            <p>"Ferramenta incrível e fácil de usar. A análise de dados salvou-me milhares de euros."</p>
            <cite>- Pedro Costa, Empresário</cite>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Por que Escolher Nós -->
  <section class="py-5">
    <div class="container">
      <h2 class="text-center mb-5">Por que Escolher a Consultoria Auto Premium?</h2>
      <div class="row">
        <div class="col-md-4 text-center">
          <i class="fas fa-brain fa-3x text-primary mb-3"></i>
          <h5>IA Avançada</h5>
          <p>Utilizamos algoritmos de ponta para analisar tendências e fornecer recomendações precisas.</p>
        </div>
        <div class="col-md-4 text-center">
          <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
          <h5>Análise de Dados</h5>
          <p>Baseamos nossas recomendações em dados históricos reais do mercado automóvel.</p>
        </div>
        <div class="col-md-4 text-center">
          <i class="fas fa-users fa-3x text-primary mb-3"></i>
          <h5>Suporte Personalizado</h5>
          <p>Oferecemos consultoria personalizada para cada cliente, garantindo o sucesso do seu negócio.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Sobre Nós -->
  <section id="sobre" class="py-5 bg-light">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h2>Sobre Nós</h2>
          <p>A Consultoria Auto Premium utiliza algoritmos de mineração de dados, como o Apriori, para analisar associações em dados históricos de stands de carros no Grande Porto. Ajudamos empreendedores a escolherem os melhores locais com base em fatores como gama, orçamento e perfil de cliente.</p>
        </div>
        <div class="col-md-6">
          <img src="https://images.unsplash.com/photo-1503736334956-4c8f8e92946d?auto=format&fit=crop&w=900&q=80" class="img-fluid rounded" alt="Consultoria">
        </div>
      </div>
    </div>
  </section>

  <!-- Contacto -->
  <section id="contacto" class="py-5">
    <div class="container">
      <h2 class="text-center mb-4">Entre em Contacto</h2>
      <div class="row justify-content-center">
        <div class="col-md-6">
          <form id="contactForm">
            <div class="mb-3">
              <label for="nome" class="form-label">Nome</label>
              <input type="text" class="form-control" id="nome" required>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" required>
            </div>
            <div class="mb-3">
              <label for="mensagem" class="form-label">Mensagem</label>
              <textarea class="form-control" id="mensagem" rows="4" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary w-100">Enviar Mensagem</button>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="text-center">
    <div class="container">
      <p class="mb-0">© 2025 Consultoria Auto Premium. Todos os direitos reservados.</p>
    </div>
  </footer>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <script src="apriori.js"></script>
  <script src="analytics.js"></script>
  <script>
    // Check login status on page load
    console.log('Checking login status:', localStorage.getItem('loggedIn'));
    // Temporarily disabled for fictional direct access demo
    // if (localStorage.getItem('loggedIn') !== 'true') {
    //   console.log('Not logged in, redirecting to login.html');
    //   window.location.href = 'login.html';
    // } else {
    //   console.log('Logged in, staying on page');
    // }
    console.log('Direct access enabled for demo');

    let currentRecommendation = null;
    let currentRespostas = null;
    let feedbackGiven = false;

    // Suporte multi-idioma
    const translations = {
      pt: {
        title: "Consultoria Auto Premium",
        heroTitle: "Encontre o Melhor Local para seu Stand de Carros",
        heroSubtitle: "No Grande Porto, utilizando análise de dados avançada com o método Apriori.",
        startConsultation: "Iniciar Consultoria",
        innovativeMethod: "Método Inovador:",
        innovativeDescription: "Nosso Apriori avançado incorpora machine learning leve para ajustar confianças em tempo real, garantindo recomendações mais precisas e adaptáveis às mudanças econômicas.",
        consultationTool: "Ferramenta de Consultoria com Apriori Inovador",
        consultationDescription: "Utilizamos uma versão inovadora do algoritmo Apriori que analisa associações multidimensionais em dados históricos, considerando não apenas combinações simples, mas também pesos dinâmicos baseados em tendências atuais do mercado automóvel no Grande Porto. Responda às perguntas abaixo para receber uma recomendação personalizada.",
        typeOfRange: "Tipo de Gama",
        budget: "Orçamento",
        clientType: "Tipo de Cliente Alvo",
        locationPreference: "Preferência de Localização",
        specificLocation: "Local Específico (Opcional)",
        specificLocationPlaceholder: "Ex: Porto Centro, Vila Nova de Gaia, etc.",
        specificLocationHelp: "Se preferir um local específico, selecione uma das opções disponíveis ou indique outro local. Caso contrário, receberá uma recomendação baseada nos seus critérios.",
        advancedFilters: "Filtros Avançados",
        budgetRange: "Faixa de Orçamento (€)",
        minimum: "Mínimo",
        maximum: "Máximo",
        carTypes: "Tipos de Carro",
        carTypesHelp: "Selecione múltiplos tipos pressionando Ctrl (ou Cmd no Mac).",
        clientAgeRange: "Faixa Etária do Cliente",
        incomeLevel: "Nível de Rendimento",
        generateRecommendation: "Gerar Recomendação",
        personalizedRecommendation: "Recomendação Personalizada",
        wasThisUseful: "Esta recomendação foi útil?",
        yes: "Sim",
        no: "Não",
        exportReport: "Exportar Relatório",
        share: "Compartilhar",
        directions: "Direções",
        nearbyAmenities: "Comodidades Próximas:",
        comparisonTitle: "Comparação de Locais Recomendados",
        historyTitle: "Histórico de Recomendações",
        historyDescription: "Aqui pode ver todas as recomendações geradas anteriormente, incluindo os critérios utilizados e o feedback dado.",
        noRecommendations: "Nenhuma recomendação gerada ainda.",
        criteria: "Critérios:",
        date: "Data:",
        feedback: "Feedback:",
        none: "Nenhum",
        clearHistory: "Limpar Histórico",
        confirmClearHistory: "Tem certeza de que deseja limpar todo o histórico de recomendações?",
        historyCleared: "Histórico limpo com sucesso.",
        statsTitle: "Estatísticas",
        recommendationsGenerated: "Recomendações Geradas",
        clientSatisfaction: "Satisfação dos Clientes",
        yearsExperience: "Anos de Experiência",
        locationsPorto: "Locais no Grande Porto",
        testimonialsTitle: "O que Nossos Clientes Dizem",
        testimonial1: "\"A recomendação da Consultoria Auto Premium foi perfeita! Abri meu stand em Vila Nova de Gaia e o negócio está a prosperar.\"",
        testimonialAuthor1: "- João Silva, Empreendedor",
        testimonial2: "\"O método Apriori inovador deu-me confiança para investir. Recomendo a todos!\"",
        testimonialAuthor2: "- Maria Santos, Investidora",
        testimonial3: "\"Ferramenta incrível e fácil de usar. A análise de dados salvou-me milhares de euros.\"",
        testimonialAuthor3: "- Pedro Costa, Empresário",
        whyChooseUs: "Por que Escolher a Consultoria Auto Premium?",
        advancedAI: "IA Avançada",
        advancedAIDescription: "Utilizamos algoritmos de ponta para analisar tendências e fornecer recomendações precisas.",
        dataAnalysis: "Análise de Dados",
        dataAnalysisDescription: "Baseamos nossas recomendações em dados históricos reais do mercado automóvel.",
        personalizedSupport: "Suporte Personalizado",
        personalizedSupportDescription: "Oferecemos consultoria personalizada para cada cliente, garantindo o sucesso do seu negócio.",
        aboutUsDescription: "A Consultoria Auto Premium utiliza algoritmos de mineração de dados, como o Apriori, para analisar associações em dados históricos de stands de carros no Grande Porto. Ajudamos empreendedores a escolherem os melhores locais com base em fatores como gama, orçamento e perfil de cliente.",
        contact: "Entre em Contacto",
        name: "Nome",
        email: "Email",
        message: "Mensagem",
        sendMessage: "Enviar Mensagem",
        footerText: "© 2025 Consultoria Auto Premium. Todos os direitos reservados.",
        select: "Selecione",
        luxury: "Luxo",
        medium: "Médio",
        economic: "Económico",
        low: "Baixo",
        medium: "Médio",
        high: "Alto",
        families: "Famílias",
        young: "Jovens",
        executives: "Executivos",
        center: "Centro",
        suburbs: "Subúrbios",
        beach: "Próximo à Praia",
        sedan: "Sedan",
        suv: "SUV",
        hatchback: "Hatchback",
        coupe: "Coupe",
        pickup: "Pickup",
        electric: "Elétrico",
        age18_25: "18-25 anos",
        age26_40: "26-40 anos",
        age41_60: "41-60 anos",
        age60plus: "60+ anos",
        positiveFeedback: "Obrigado pelo feedback positivo! A confiança desta recomendação foi aumentada.",
        negativeFeedback: "Obrigado pelo feedback. Vamos melhorar as nossas recomendações.",
        reportExported: "Relatório exportado com sucesso!",
        recommendationCopied: "Recomendação copiada para a área de transferência!",
        coordinatesNotAvailable: "Coordenadas não disponíveis para este local.",
        restaurant: "Restaurante",
        parking: "Estacionamento",
        supermarket: "Supermercado",
        pharmacy: "Farmácia",
        distance: "Distância:",
        consultation: "Consultoria",
        history: "Histórico",
        about: "Sobre Nós",
        contactLink: "Contacto"
      },
      en: {
        title: "Auto Premium Consultancy",
        heroTitle: "Find the Best Location for Your Car Dealership",
        heroSubtitle: "In Greater Porto, using advanced data analysis with the Apriori method.",
        startConsultation: "Start Consultation",
        innovativeMethod: "Innovative Method:",
        innovativeDescription: "Our advanced Apriori incorporates light machine learning to adjust confidences in real-time, ensuring more accurate and adaptable recommendations to economic changes.",
        consultationTool: "Consultation Tool with Innovative Apriori",
        consultationDescription: "We use an innovative version of the Apriori algorithm that analyzes multidimensional associations in historical data, considering not only simple combinations, but also dynamic weights based on current automotive market trends in Greater Porto. Answer the questions below to receive a personalized recommendation.",
        typeOfRange: "Type of Range",
        budget: "Budget",
        clientType: "Target Client Type",
        locationPreference: "Location Preference",
        specificLocation: "Specific Location (Optional)",
        specificLocationPlaceholder: "Ex: Porto Centro, Vila Nova de Gaia, etc.",
        specificLocationHelp: "If you prefer a specific location, select one of the available options or indicate another location. Otherwise, you will receive a recommendation based on your criteria.",
        advancedFilters: "Advanced Filters",
        budgetRange: "Budget Range (€)",
        minimum: "Minimum",
        maximum: "Maximum",
        carTypes: "Car Types",
        carTypesHelp: "Select multiple types by pressing Ctrl (or Cmd on Mac).",
        clientAgeRange: "Client Age Range",
        incomeLevel: "Income Level",
        generateRecommendation: "Generate Recommendation",
        personalizedRecommendation: "Personalized Recommendation",
        wasThisUseful: "Was this recommendation useful?",
        yes: "Yes",
        no: "No",
        exportReport: "Export Report",
        share: "Share",
        directions: "Directions",
        nearbyAmenities: "Nearby Amenities:",
        comparisonTitle: "Comparison of Recommended Locations",
        historyTitle: "Recommendations History",
        historyDescription: "Here you can see all previously generated recommendations, including the criteria used and the feedback given.",
        noRecommendations: "No recommendations generated yet.",
        criteria: "Criteria:",
        date: "Date:",
        feedback: "Feedback:",
        none: "None",
        clearHistory: "Clear History",
        confirmClearHistory: "Are you sure you want to clear all recommendation history?",
        historyCleared: "History cleared successfully.",
        statsTitle: "Statistics",
        recommendationsGenerated: "Recommendations Generated",
        clientSatisfaction: "Client Satisfaction",
        yearsExperience: "Years of Experience",
        locationsPorto: "Locations in Greater Porto",
        testimonialsTitle: "What Our Clients Say",
        testimonial1: "\"The recommendation from Auto Premium Consultancy was perfect! I opened my dealership in Vila Nova de Gaia and the business is thriving.\"",
        testimonialAuthor1: "- João Silva, Entrepreneur",
        testimonial2: "\"The innovative Apriori method gave me confidence to invest. I recommend it to everyone!\"",
        testimonialAuthor2: "- Maria Santos, Investor",
        testimonial3: "\"Incredible and easy-to-use tool. Data analysis saved me thousands of euros.\"",
        testimonialAuthor3: "- Pedro Costa, Businessman",
        whyChooseUs: "Why Choose Auto Premium Consultancy?",
        advancedAI: "Advanced AI",
        advancedAIDescription: "We use cutting-edge algorithms to analyze trends and provide accurate recommendations.",
        dataAnalysis: "Data Analysis",
        dataAnalysisDescription: "We base our recommendations on real historical data from the automotive market.",
        personalizedSupport: "Personalized Support",
        personalizedSupportDescription: "We offer personalized consulting for each client, ensuring the success of your business.",
        aboutUs: "About Us",
        aboutUsDescription: "Auto Premium Consultancy uses data mining algorithms, such as Apriori, to analyze associations in historical data of car dealerships in Greater Porto. We help entrepreneurs choose the best locations based on factors such as range, budget and client profile.",
        contact: "Get in Touch",
        name: "Name",
        email: "Email",
        message: "Message",
        sendMessage: "Send Message",
        footerText: "© 2025 Auto Premium Consultancy. All rights reserved.",
        select: "Select",
        luxury: "Luxury",
        medium: "Medium",
        economic: "Economic",
        low: "Low",
        medium: "Medium",
        high: "High",
        families: "Families",
        young: "Young",
        executives: "Executives",
        center: "Center",
        suburbs: "Suburbs",
        beach: "Near the Beach",
        sedan: "Sedan",
        suv: "SUV",
        hatchback: "Hatchback",
        coupe: "Coupe",
        pickup: "Pickup",
        electric: "Electric",
        age18_25: "18-25 years",
        age26_40: "26-40 years",
        age41_60: "41-60 years",
        age60plus: "60+ years",
        positiveFeedback: "Thank you for the positive feedback! The confidence of this recommendation has been increased.",
        negativeFeedback: "Thank you for the feedback. We will improve our recommendations.",
        reportExported: "Report exported successfully!",
        recommendationCopied: "Recommendation copied to clipboard!",
        coordinatesNotAvailable: "Coordinates not available for this location.",
        restaurant: "Restaurant",
        parking: "Parking",
        supermarket: "Supermarket",
        pharmacy: "Pharmacy",
        distance: "Distance:",
        consultation: "Consultation",
        history: "History",
        about: "About Us",
        contactLink: "Contact"
      }
    };

    let currentLanguage = localStorage.getItem('language') || 'pt';

    function setLanguage(lang) {
      currentLanguage = lang;
      localStorage.setItem('language', lang);
      updateTexts();
    }

    function updateTexts() {
      const t = translations[currentLanguage];
      document.title = t.title;
      document.querySelector('.navbar-brand').textContent = t.title;
      document.querySelector('.hero h1').textContent = t.heroTitle;
      document.querySelector('.hero p').textContent = t.heroSubtitle;
      document.querySelector('.hero .btn').textContent = t.startConsultation;
      document.querySelector('.alert strong').textContent = t.innovativeMethod;
      document.querySelector('.alert').childNodes[2].textContent = t.innovativeDescription;
      document.querySelector('#consultoria h2').textContent = t.consultationTool;
      document.querySelector('#consultoria p').textContent = t.consultationDescription;
      document.querySelector('label[for="gama"]').textContent = t.typeOfRange;
      document.querySelector('label[for="orcamento"]').textContent = t.budget;
      document.querySelector('label[for="cliente"]').textContent = t.clientType;
      document.querySelector('label[for="localizacao"]').textContent = t.locationPreference;
      document.querySelector('label[for="localEspecifico"]').textContent = t.specificLocation;
      document.querySelector('#localEspecifico').placeholder = t.specificLocationPlaceholder;
      document.querySelector('.form-text').textContent = t.specificLocationHelp;
      document.querySelector('.btn[data-bs-toggle="collapse"]').textContent = t.advancedFilters;
      document.querySelector('label[for="faixaOrcamento"]').textContent = t.budgetRange;
      document.querySelector('#orcamentoMin').placeholder = t.minimum;
      document.querySelector('#orcamentoMax').placeholder = t.maximum;
      document.querySelector('label[for="tiposCarro"]').textContent = t.carTypes;
      document.querySelector('#tiposCarro').nextElementSibling.textContent = t.carTypesHelp;
      document.querySelector('label[for="faixaEtaria"]').textContent = t.clientAgeRange;
      document.querySelector('label[for="nivelRendimento"]').textContent = t.incomeLevel;
      document.querySelector('#consultoriaForm button[type="submit"]').textContent = t.generateRecommendation;
      document.querySelector('#resultado h5').textContent = t.personalizedRecommendation;
      document.querySelector('#resultado p').textContent = t.wasThisUseful;
      document.querySelector('#thumbsUp').innerHTML = `<i class="fas fa-thumbs-up"></i> ${t.yes}`;
      document.querySelector('#thumbsDown').innerHTML = `<i class="fas fa-thumbs-down"></i> ${t.no}`;
      document.querySelector('#exportBtn').innerHTML = `<i class="fas fa-download"></i> ${t.exportReport}`;
      document.querySelector('#shareBtn').innerHTML = `<i class="fas fa-share"></i> ${t.share}`;
      document.querySelector('#directionsBtn').innerHTML = `<i class="fas fa-route"></i> ${t.directions}`;
      document.querySelector('#nearbyAmenities h6').textContent = t.nearbyAmenities;
      document.querySelector('#comparacaoSection h5').textContent = t.comparisonTitle;
      document.querySelector('#historico h2').textContent = t.historyTitle;
      document.querySelector('#historico p').textContent = t.historyDescription;
      document.querySelector('#limparHistorico').textContent = t.clearHistory;
      document.querySelector('.stats h3:nth-child(1)').nextElementSibling.textContent = t.recommendationsGenerated;
      document.querySelector('.stats h3:nth-child(2)').nextElementSibling.textContent = t.clientSatisfaction;
      document.querySelector('.stats h3:nth-child(3)').nextElementSibling.textContent = t.yearsExperience;
      document.querySelector('.stats h3:nth-child(4)').nextElementSibling.textContent = t.locationsPorto;
      document.querySelector('.py-5.bg-light h2').textContent = t.testimonialsTitle;
      document.querySelectorAll('.testimonial p')[0].textContent = t.testimonial1;
      document.querySelectorAll('.testimonial cite')[0].textContent = t.testimonialAuthor1;
      document.querySelectorAll('.testimonial p')[1].textContent = t.testimonial2;
      document.querySelectorAll('.testimonial cite')[1].textContent = t.testimonialAuthor2;
      document.querySelectorAll('.testimonial p')[2].textContent = t.testimonial3;
      document.querySelectorAll('.testimonial cite')[2].textContent = t.testimonialAuthor3;
      document.querySelector('.py-5:not(.bg-light) h2').textContent = t.whyChooseUs;
      document.querySelectorAll('.text-center h5')[0].textContent = t.advancedAI;
      document.querySelectorAll('.text-center p')[0].textContent = t.advancedAIDescription;
      document.querySelectorAll('.text-center h5')[1].textContent = t.dataAnalysis;
      document.querySelectorAll('.text-center p')[1].textContent = t.dataAnalysisDescription;
      document.querySelectorAll('.text-center h5')[2].textContent = t.personalizedSupport;
      document.querySelectorAll('.text-center p')[2].textContent = t.personalizedSupportDescription;
      document.querySelector('#sobre h2').textContent = t.aboutUs;
      document.querySelector('#sobre p').textContent = t.aboutUsDescription;
      document.querySelector('#contacto h2').textContent = t.contact;
      document.querySelector('label[for="nome"]').textContent = t.name;
      document.querySelector('label[for="email"]').textContent = t.email;
      document.querySelector('label[for="mensagem"]').textContent = t.message;
      document.querySelector('#contacto button').textContent = t.sendMessage;
      document.querySelector('footer p').textContent = t.footerText;

      // Navbar links
      const navLinks = document.querySelectorAll('.navbar-nav .nav-link');
      navLinks[0].textContent = t.consultation;
      navLinks[1].textContent = t.history;
      navLinks[2].textContent = t.about;
      navLinks[3].textContent = t.contactLink;

      // Select options
      const selects = document.querySelectorAll('select');
      selects.forEach(select => {
        const options = select.querySelectorAll('option');
        options[0].textContent = t.select;
        if (select.id === 'gama') {
          options[1].textContent = t.luxury;
          options[2].textContent = t.medium;
          options[3].textContent = t.economic;
        } else if (select.id === 'orcamento') {
          options[1].textContent = t.low;
          options[2].textContent = t.medium;
          options[3].textContent = t.high;
        } else if (select.id === 'cliente') {
          options[1].textContent = t.families;
          options[2].textContent = t.young;
          options[3].textContent = t.executives;
        } else if (select.id === 'localizacao') {
          options[1].textContent = t.center;
          options[2].textContent = t.suburbs;
          options[3].textContent = t.beach;
        } else if (select.id === 'tiposCarro') {
          // Multiple select
        } else if (select.id === 'faixaEtaria') {
          options[1].textContent = t.age18_25;
          options[2].textContent = t.age26_40;
          options[3].textContent = t.age41_60;
          options[4].textContent = t.age60plus;
        } else if (select.id === 'nivelRendimento') {
          options[1].textContent = t.low;
          options[2].textContent = t.medium;
          options[3].textContent = t.high;
        }
      });

      // Car types options
      const carTypeOptions = document.querySelectorAll('#tiposCarro option');
      carTypeOptions[0].textContent = t.sedan;
      carTypeOptions[1].textContent = t.suv;
      carTypeOptions[2].textContent = t.hatchback;
      carTypeOptions[3].textContent = t.coupe;
      carTypeOptions[4].textContent = t.pickup;
      carTypeOptions[5].textContent = t.electric;
    }

    // Dados padrão
    let locaisConhecidos = {
      'Porto Centro': { lat: 41.1579, lng: -8.6291, image: 'https://via.placeholder.com/800x400?text=Porto+Centro', description: 'Centro histórico do Porto, ideal para stands de luxo com alta visibilidade.' },
      'Vila Nova de Gaia': { lat: 41.1333, lng: -8.6167, image: 'https://via.placeholder.com/800x400?text=Vila+Nova+de+Gaia', description: 'Subúrbio familiar com acesso fácil ao Porto, perfeito para famílias.' },
      'Leça da Palmeira': { lat: 41.1917, lng: -8.7000, image: 'https://via.placeholder.com/800x400?text=Le%C3%A7a+da+Palmeira', description: 'Área costeira vibrante, atrativa para jovens e turismo.' },
      'Gondomar': { lat: 41.1500, lng: -8.5333, image: 'https://via.placeholder.com/800x400?text=Gondomar', description: 'Área residencial acessível, ideal para famílias com orçamento limitado.' },
      'Maia': { lat: 41.2333, lng: -8.6167, image: 'https://via.placeholder.com/800x400?text=Maia', description: 'Subúrbio moderno com boas infraestruturas familiares.' },
      'Póvoa de Varzim': { lat: 41.3833, lng: -8.7667, image: 'https://via.placeholder.com/800x400?text=P%C3%B3voa+de+Varzim', description: 'Costa norte com praias e vida noturna, atrativa para jovens.' }
    };

    let regrasRelacionadas = [
      { antecedente: ['luxo', 'alto', 'executivos'], consequente: 'Porto Centro', confidence: 0.8 },
      { antecedente: ['medio', 'medio', 'familias'], consequente: 'Vila Nova de Gaia', confidence: 0.75 },
      { antecedente: ['economico', 'baixo', 'jovens'], consequente: 'Leça da Palmeira', confidence: 0.7 },
      { antecedente: ['economico', 'baixo', 'familias'], consequente: 'Gondomar', confidence: 0.55 },
      { antecedente: ['luxo', 'medio', 'familias'], consequente: 'Maia', confidence: 0.6 },
      { antecedente: ['economico', 'medio', 'jovens'], consequente: 'Póvoa de Varzim', confidence: 0.65 }
    ];

    // Carregar dados aprendidos do localStorage
    function loadLearnedData() {
      const savedLocais = localStorage.getItem('locaisConhecidos');
      if (savedLocais) {
        const learnedLocais = JSON.parse(savedLocais);
        locaisConhecidos = { ...locaisConhecidos, ...learnedLocais };
      }
      const savedRegras = localStorage.getItem('regrasRelacionadas');
      if (savedRegras) {
        const learnedRegras = JSON.parse(savedRegras);
        regrasRelacionadas = [...regrasRelacionadas, ...learnedRegras];
      }
    }

    // Carregar histórico de recomendações
    function loadHistorico() {
      const historico = JSON.parse(localStorage.getItem('historicoRecomendacoes') || '[]');
      const historicoLista = document.getElementById('historicoLista');
      historicoLista.innerHTML = '';

      if (historico.length === 0) {
        historicoLista.innerHTML = '<div class="col-12 text-center"><p class="text-muted">Nenhuma recomendação gerada ainda.</p></div>';
        return;
      }

      historico.forEach((item, index) => {
        const col = document.createElement('div');
        col.className = 'col-md-6 mb-4';
        col.innerHTML = `
          <div class="card h-100">
            <div class="card-body">
              <h6 class="card-title">${item.local}</h6>
              <p class="card-text"><strong>Critérios:</strong> ${item.criterios.join(', ')}</p>
              <p class="card-text"><strong>Data:</strong> ${new Date(item.data).toLocaleString('pt-PT')}</p>
              <p class="card-text"><strong>Feedback:</strong> ${item.feedback || 'Nenhum'}</p>
            </div>
          </div>
        `;
        historicoLista.appendChild(col);
      });
    }

    // Salvar recomendação no histórico
    function salvarNoHistorico(recomendacao, criterios, feedback) {
      const historico = JSON.parse(localStorage.getItem('historicoRecomendacoes') || '[]');
      historico.push({
        local: recomendacao.consequente,
        criterios: criterios,
        data: new Date().toISOString(),
        feedback: feedback
      });
      localStorage.setItem('historicoRecomendacoes', JSON.stringify(historico));
      loadHistorico();
    }

    // Limpar histórico
    document.getElementById('limparHistorico').addEventListener('click', function() {
      if (confirm('Tem certeza de que deseja limpar todo o histórico de recomendações?')) {
        localStorage.removeItem('historicoRecomendacoes');
        loadHistorico();
        alert('Histórico limpo com sucesso.');
      }
    });

    // Salvar dados aprendidos no localStorage
    function saveLearnedData() {
      localStorage.setItem('locaisConhecidos', JSON.stringify(locaisConhecidos));
      localStorage.setItem('regrasRelacionadas', JSON.stringify(regrasRelacionadas));
    }



    // Carregar dados ao iniciar
    loadLearnedData();

    // Atualizar datalist com locais conhecidos
    function updateLocaisDatalist() {
      const datalist = document.getElementById('locaisDisponiveis');
      datalist.innerHTML = '';
      Object.keys(locaisConhecidos).forEach(local => {
        const option = document.createElement('option');
        option.value = local;
        datalist.appendChild(option);
      });
    }

    updateLocaisDatalist();

    // Event listener para gama luxo definir orçamento automaticamente
    document.getElementById('gama').addEventListener('change', function() {
      const orcamentoSelect = document.getElementById('orcamento');
      if (this.value === 'luxo') {
        orcamentoSelect.value = 'alto';
        orcamentoSelect.disabled = true;
      } else {
        orcamentoSelect.disabled = false;
        if (orcamentoSelect.value === 'alto') {
          orcamentoSelect.value = '';
        }
      }
    });

    // Event listeners para feedback (definidos uma vez)
    document.getElementById('thumbsUp').addEventListener('click', function() {
      if (currentRecommendation && currentRespostas) {
        feedbackGiven = true;
        salvarNoHistorico(currentRecommendation, currentRespostas, 'Sim');
        ajustarConfiança(currentRecommendation.consequente, true);
        alert('Obrigado pelo feedback positivo! A confiança desta recomendação foi aumentada.');
        document.getElementById('thumbsUp').disabled = true;
        document.getElementById('thumbsDown').disabled = true;
      }
    });

    document.getElementById('thumbsDown').addEventListener('click', function() {
      if (currentRecommendation && currentRespostas) {
        feedbackGiven = true;
        salvarNoHistorico(currentRecommendation, currentRespostas, 'Não');
        ajustarConfiança(currentRecommendation.consequente, false);
        alert('Obrigado pelo feedback. Vamos melhorar as nossas recomendações.');
        document.getElementById('thumbsUp').disabled = true;
        document.getElementById('thumbsDown').disabled = true;
      }
    });

    // Event listeners para botões de ação (definidos uma vez)
    document.getElementById('exportBtn').addEventListener('click', function() {
      if (currentRecommendation && currentRespostas) {
        exportarRelatorio(currentRecommendation, currentRespostas);
      }
    });

    document.getElementById('shareBtn').addEventListener('click', function() {
      if (currentRecommendation) {
        compartilharRecomendacao(currentRecommendation);
      }
    });

    document.getElementById('directionsBtn').addEventListener('click', function() {
      if (currentRecommendation) {
        mostrarDirecoes(currentRecommendation);
      }
    });

    document.getElementById('consultoriaForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const gama = document.getElementById('gama').value;
      const orcamento = document.getElementById('orcamento').value;
      const cliente = document.getElementById('cliente').value;
      const localizacao = document.getElementById('localizacao').value;
      const localEspecifico = document.getElementById('localEspecifico').value.trim();

      // Filtros avançados
      const orcamentoMin = document.getElementById('orcamentoMin').value;
      const orcamentoMax = document.getElementById('orcamentoMax').value;
      const tiposCarro = Array.from(document.getElementById('tiposCarro').selectedOptions).map(option => option.value);
      const faixaEtaria = document.getElementById('faixaEtaria').value;
      const nivelRendimento = document.getElementById('nivelRendimento').value;

      const respostas = [gama, orcamento, cliente, localizacao];
      const filtrosAvancados = {
        orcamentoMin: orcamentoMin ? parseInt(orcamentoMin) : null,
        orcamentoMax: orcamentoMax ? parseInt(orcamentoMax) : null,
        tiposCarro: tiposCarro,
        faixaEtaria: faixaEtaria,
        nivelRendimento: nivelRendimento
      };

      // Dados de transações simulados (associações históricas)
      const transactions = [
        ['luxo', 'alto', 'executivos', 'centro', 'Porto Centro'],
        ['luxo', 'alto', 'executivos', 'centro', 'Porto Centro'],
        ['medio', 'medio', 'familias', 'subúrbios', 'Vila Nova de Gaia'],
        ['medio', 'medio', 'familias', 'subúrbios', 'Vila Nova de Gaia'],
        ['economico', 'baixo', 'jovens', 'praia', 'Leça da Palmeira'],
        ['economico', 'baixo', 'jovens', 'praia', 'Leça da Palmeira'],
        ['luxo', 'alto', 'executivos', 'centro', 'Porto Centro'],
        ['medio', 'medio', 'jovens', 'centro', 'Porto Centro'],
        ['economico', 'baixo', 'familias', 'subúrbios', 'Gondomar'],
        ['luxo', 'medio', 'familias', 'subúrbios', 'Maia'],
        ['medio', 'alto', 'executivos', 'centro', 'Porto Centro'],
        ['economico', 'medio', 'jovens', 'praia', 'Póvoa de Varzim']
      ];

      let melhorRegra;
      let recomendacaoTexto;

      if (localEspecifico) {
        // Usar local específico fornecido pelo usuário
        const localInfo = locaisConhecidos[localEspecifico];
        if (localInfo) {
          // Calcular confiança baseada nas respostas do usuário usando o Apriori
          const regraLocal = regrasRelacionadas.find(r => r.consequente === localEspecifico);
          const confianca = regraLocal ? (regraLocal.confidence * 100).toFixed(0) : '75'; // 75% como padrão para locais conhecidos

          let qualidade;
          if (confianca >= 80) {
            qualidade = 'excelente';
          } else if (confianca >= 60) {
            qualidade = 'Boa';
          } else {
            qualidade = 'baixa';
          }

          melhorRegra = {
            recomendacao: `Você escolheu abrir o stand em ${localEspecifico}. Confiança baseada no Apriori: ${confianca}%. Esta é uma escolha de qualidade ${qualidade} baseada nos seus critérios.`,
            ...localInfo,
            consequente: localEspecifico
          };
        } else {
          // Local não reconhecido, aprender e adicionar à base de dados
          // Adicionar novo local com valores padrão
          locaisConhecidos[localEspecifico] = {
            lat: 41.1579, // Porto como fallback
            lng: -8.6291,
            image: 'https://images.unsplash.com/photo-1503736334956-4c8f8e92946d?auto=format&fit=crop&w=800&q=80',
            description: `Local personalizado: ${localEspecifico}. Adicionado à base de dados baseada nas suas preferências.`
          };

          // Adicionar nova regra baseada nas respostas do usuário
          const novaRegra = {
            antecedente: [gama, orcamento, cliente, localizacao],
            consequente: localEspecifico,
            confidence: 0.5 // Confiança inicial para novos locais
          };
          regrasRelacionadas.push(novaRegra);

          // Salvar dados aprendidos
          saveLearnedData();

          melhorRegra = {
            recomendacao: `Novo local aprendido: ${localEspecifico}. Adicionado à nossa base de dados com base nas suas preferências. Confiança inicial: 50%. Recomendamos consultar um especialista local para avaliação detalhada.`,
            ...locaisConhecidos[localEspecifico],
            consequente: localEspecifico
          };
        }
      } else {
        // Usar recomendação baseada no Apriori
        melhorRegra = gerarRecomendacao(transactions, respostas, filtrosAvancados, 0.5, 0.7); // minSupport 50%, minConfidence 70%
      }

      document.getElementById('recomendacao').textContent = melhorRegra.recomendacao;
      document.getElementById('resultado').classList.remove('d-none');

      // Mostrar seção de comparação se houver melhoresRegras
      if (melhorRegra.melhoresRegras && melhorRegra.melhoresRegras.length > 1) {
        document.getElementById('comparacaoSection').classList.remove('d-none');
        const container = document.getElementById('comparacaoContainer');
        container.innerHTML = '';
        melhorRegra.melhoresRegras.forEach((regra, index) => {
          const card = document.createElement('div');
          card.className = 'col-md-4 mb-4';
          card.innerHTML = `
            <div class="card h-100">
              <img src="${regra.image}" class="card-img-top" alt="${regra.consequente}" style="height: 200px; object-fit: cover;">
              <div class="card-body">
                <h5 class="card-title">${index + 1}. ${regra.consequente}</h5>
                <p class="card-text"><strong>Confiança Ajustada:</strong> ${(regra.confidenceAjustada * 100).toFixed(0)}%</p>
                <p class="card-text">${regra.description}</p>
                <p class="card-text"><strong>Coordenadas:</strong> ${regra.lat}, ${regra.lng}</p>
              </div>
            </div>
          `;
          container.appendChild(card);
        });
      } else {
        document.getElementById('comparacaoSection').classList.add('d-none');
      }

      // Set current recommendation and responses
      currentRecommendation = melhorRegra;
      currentRespostas = respostas;
      feedbackGiven = false;

      // Timeout para salvar com "nenhum" se nenhum feedback for dado
      setTimeout(() => {
        if (!feedbackGiven) {
          salvarNoHistorico(currentRecommendation, currentRespostas, 'nenhum');
        }
      }, 30000); // 30 segundos

      // Atualizar imagem e descrição
      if (melhorRegra.image) {
        document.getElementById('localImage').src = melhorRegra.image;
        document.getElementById('localImage').alt = melhorRegra.consequente || 'Local Selecionado';
      }
      if (melhorRegra.description) {
        document.getElementById('localDescription').textContent = melhorRegra.description;
      }

      // Atualizar imagem do mapa com um mapa mundial destacando o Grande Porto
      if (melhorRegra.consequente) {
        document.getElementById('map').src = 'img/mapa.png';
        document.getElementById('map').alt = 'Mapa do Grande Porto';
      }



      // Enable feedback buttons
      document.getElementById('thumbsUp').disabled = false;
      document.getElementById('thumbsDown').disabled = false;

      // Mostrar comodidades próximas
      mostrarComodidadesProximas(melhorRegra);
    });

    // Função para ajustar confiança baseada no feedback
    function ajustarConfiança(local, positivo) {
      const regra = regrasRelacionadas.find(r => r.consequente === local);
      if (regra) {
        if (positivo) {
          regra.confidence = Math.min(1.0, regra.confidence + 0.05); // Aumentar confiança em 5%
        } else {
          regra.confidence = Math.max(0.0, regra.confidence - 0.05); // Diminuir confiança em 5%
        }
        saveLearnedData();
      }
    }

    // Função para exportar relatório
    function exportarRelatorio(recomendacao, criterios) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFontSize(20);
      doc.text('Relatório de Recomendação - Consultoria Auto Premium', 20, 30);

      doc.setFontSize(14);
      doc.text(`Local Recomendado: ${recomendacao.consequente}`, 20, 50);
      doc.text(`Critérios Utilizados: ${criterios.join(', ')}`, 20, 70);
      doc.text(`Descrição: ${recomendacao.description}`, 20, 90);
      doc.text(`Confiança: ${recomendacao.confidence ? (recomendacao.confidence * 100).toFixed(0) + '%' : 'N/A'}`, 20, 110);
      doc.text(`Data: ${new Date().toLocaleDateString('pt-PT')}`, 20, 130);

      doc.save('relatorio_recomendacao.pdf');
      alert('Relatório exportado com sucesso!');
    }

    // Função para compartilhar recomendação
    function compartilharRecomendacao(recomendacao) {
      const texto = `Recomendação da Consultoria Auto Premium: ${recomendacao.consequente}. ${recomendacao.description}`;
      const url = window.location.href;

      if (navigator.share) {
        navigator.share({
          title: 'Recomendação de Local - Consultoria Auto Premium',
          text: texto,
          url: url
        });
      } else {
        // Fallback para copiar para clipboard
        navigator.clipboard.writeText(`${texto} ${url}`).then(() => {
          alert('Recomendação copiada para a área de transferência!');
        });
      }
    }

    // Função para mostrar direções
    function mostrarDirecoes(recomendacao) {
      if (recomendacao.lat && recomendacao.lng) {
        const url = `https://www.google.com/maps/dir/?api=1&destination=${recomendacao.lat},${recomendacao.lng}`;
        window.open(url, '_blank');
      } else {
        alert('Coordenadas não disponíveis para este local.');
      }
    }

    // Função para mostrar comodidades próximas
    function mostrarComodidadesProximas(recomendacao) {
      if (!recomendacao.lat || !recomendacao.lng) return;

      const amenitiesSection = document.getElementById('nearbyAmenities');
      const amenitiesList = document.getElementById('amenitiesList');

      // Simular comodidades próximas (em um cenário real, usaria Places API)
      const comodidades = [
        { tipo: 'Restaurante', nome: 'Restaurante Exemplo', distancia: '0.5 km' },
        { tipo: 'Estacionamento', nome: 'Parque de Estacionamento', distancia: '0.2 km' },
        { tipo: 'Supermercado', nome: 'Supermercado Local', distancia: '1.0 km' },
        { tipo: 'Farmácia', nome: 'Farmácia Central', distancia: '0.8 km' }
      ];

      amenitiesList.innerHTML = '';
      comodidades.forEach(comodidade => {
        const col = document.createElement('div');
        col.className = 'col-md-6 mb-2';
        col.innerHTML = `
          <div class="card">
            <div class="card-body">
              <h6 class="card-title">${comodidade.tipo}</h6>
              <p class="card-text">${comodidade.nome}</p>
              <small class="text-muted">Distância: ${comodidade.distancia}</small>
            </div>
          </div>
        `;
        amenitiesList.appendChild(col);
      });

      amenitiesSection.classList.remove('d-none');
    }

    // Inicializar EmailJS
    (function() {
      emailjs.init('8oTr3sfCMTgJvfPQ7'); // Chave pública do EmailJS
    })();

    // Função para enviar email do formulário de contacto
    document.getElementById('contactForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const nome = document.getElementById('nome').value;
      const email = document.getElementById('email').value;
      const mensagem = document.getElementById('mensagem').value;

      const templateParams = {
        from_name: nome,
        reply_to: email,
        message: mensagem,
        to_email: 'magalhesantonio170@gmail.com',
        to_name: 'Consultoria Auto Premium'
      };

      emailjs.send('service_x9r0hya', 'template_qvvldga', templateParams)
        .then(function(response) {
          alert('Mensagem enviada com sucesso!');
          document.getElementById('contactForm').reset();
        }, function(error) {
          alert('Erro ao enviar mensagem. Tente novamente.');
          console.error('Erro:', error);
        });
    });

    // Event listener para enviar recomendação por email
    document.getElementById('emailRecomendacaoBtn').addEventListener('click', function() {
      if (!currentRecommendation) {
        alert('Nenhuma recomendação disponível para enviar.');
        return;
      }

      const emailCliente = document.getElementById('emailRecomendacao').value.trim();
      if (!emailCliente) {
        alert('Por favor, insira um email válido.');
        return;
      }

      const recomendacaoTexto = `Recomendação Personalizada da Consultoria Auto Premium:\n\n${currentRecommendation.recomendacao}\n\nDescrição: ${currentRecommendation.description}\n\nCritérios utilizados: ${currentRespostas.join(', ')}\n\nEmail do Cliente: ${emailCliente}\n\nData: ${new Date().toLocaleDateString('pt-PT')}`;

      const templateParams = {
        from_name: 'Consultoria Auto Premium',
        reply_to: 'noreply@consultoriaautopremium.com',
        message: recomendacaoTexto,
        to_email: 'magalhesantonio170@gmail.com',
        to_name: 'Consultoria Auto Premium'
      };

      emailjs.send('service_x9r0hya', 'template_qvvldga', templateParams)
        .then(function(response) {
          alert('Recomendação enviada por email com sucesso!');
          document.getElementById('emailRecomendacao').value = '';
        }, function(error) {
          alert('Erro ao enviar recomendação por email. Tente novamente.');
          console.error('Erro:', error);
        });
    });

    // Logout functionality
    document.getElementById('logoutBtn').addEventListener('click', function() {
      localStorage.setItem('loggedIn', 'false');
      window.location.href = 'login.html';
    });

  </script>
</body>
</html>
